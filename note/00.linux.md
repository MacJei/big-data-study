# Linux学习

##  VM与Linux安装

1.安装虚拟机VM12
​	不勾选增强型键盘驱动程序
​	不勾选启动时检查产品更新
​	不勾选用户体验
​	秘钥：5A02H-AU243-TZJ49-GTC7K-3C61N
2.安装Xshell
​	秘钥：150105-116578-999990
3.检查BIOS虚拟化支持
​	Win10：点击任务管理器->性能->右下角，虚拟化可以查看是否开启
​	一般主板：在BIOS Security 选择Virtualization Technology
​	在华硕主板中:高级->cpu设置->intel(VX) Virtualization Technology 开启
4.新建虚拟机：
​	点击创建虚拟机+
​	自定义(高级)
​	安装程序光盘镜像iso，先选择一个镜像文件，这里是centos-6.8
​	选择稍后安装操作系统
​	客户机操作系统：选择Linux，版本：CentOS64位
​	选择处理器数量4，每个核心数量2，总核心数量8
​	内存2048
​	设置网络NAT(表示本台虚拟机对外网不可见，通过windows访问，如果是桥接，则等价于2台独立的电脑访问，虚拟机对外网可见)，在完全装完后，点击网络电脑图标选择System eth0 即可上网
​	选择LSI
​	选择SCSI
​	选择磁盘大小50G，将虚拟机拆分多个文件
​	全部完成之后，点击虚拟机
​	选择CD/DVD，查找到对应的ISO文件
​	开启虚拟机进行安装CentOS，默认第一个安装
​	选择skip
​	在CentOS欢迎页面：
​		 next
​		 选择中文	
​		选择键盘语言：美国英语
​		选择存储设备：基本存储设备
​		选择忽略所有数据
​		给计算机起名字
​		网络环境等安装完成后再配置
​		选择时区：亚洲/上海
​		必要设置root密码
​		硬盘分区：创建自定义布局
​		新建根分区：点击创建->标准分区->创建->挂载点：/;文件系统类型：ext4；大小：48950，固定大小
​		创建Boot分区：点击空闲->标准分区->创建->挂载点：/boot;文件系统类型：ext4；大小：200，固定大小
​		创建swap分区（当内存超过设定值时，使用硬盘分配的swap分区大小作为内存使用，防止宕机）：点击空闲->标准分区->创建->挂载点：不适用；文件系统类型：swap；大小：2048，固定大小
​		下一步->格式化->将修改写入磁盘
​		程序引导：直接下一步
​		定制系统软件：现在自定义，下一步
​		Web服务环境：不选择
​		可扩展文件系统支持：不选择
​		基本系统：兼容程序库，基本
​		应用程序：互联网浏览器
​		其他可以都不勾选，使用时再安装
​		桌面：去除KDE桌面，其他都选
​		语言支持：中文支持
​		系统管理，虚拟化，负载均衡，高可用都可以不选
​		开始安装CentOs，安装完成，点击重新引导
​		欢迎引导页面->前进
​		许可证->同意->前进
​		创建用户：可以不创建
​		时间日期：当前时间日期
​		Kdump去除，不启用
​		重启后登陆
5.安装VMTools
​	是什么？VM的一组工具，用于虚拟化显示和调整，便于和主机交互，如创建共享文件夹，可以直接拖文件到虚拟机中，显示分辨率调整
​	安装：选择虚拟机菜单栏->安装VMwareTools
​		将.tar.gz文件拖拽到桌面
​		右键解压到此处
​		找到vmware-install.pl文件、
​		在终端中打开命令窗口，在解压的文件目录下执行./vmware-install.pl命令运行，依次回车

## Linux文件与目录结构

> Linux一切皆文件

目录结构

- / 根目录
  - **/bin**：binary的缩写，存放最经常使用的命令
  - /sbin：super user的含义，存放着系统管理员使用的系统管理程序
  - **/home**：存放普通用户的主目录，在Linux中每个用户都有一个自己的目录，一般该目录是以用户名账号命名的
  - **/root**：该目录为系统管理员，也是超级权限者用户目录
  - /lib：系统开机所需要的最基本的动态连接共享库，作用类似于windows中的dll文件，几乎所有的程序都用到了这些共享库
  - /lost+found：当系统非法关机后，存放一些文件，一般是空的
  - **/etc**：所有的系统管理所需要的配置文件和子目录
  - **/usr**：用户的应用程序和文件存在在该目录下，类似于windows的program files目录
  - **/boot**：存放系统启动时的核心文件，一些链接文件和镜像文件，一般自定义安装不放在这里
  - /proc：虚拟目录，系统**内存的映射**，通过直接访问该目录获取系统信息
  - /srv：service的缩写，该目录存放一些服务启动之后需要提取的数据
  - /sys：Linux内核2.6中新出现的文件系统sysfs
  - /tmp：存放临时文件
  - /dev：类似于windows的设备管理器，把所有的硬件用文件形式存储
  - **/media**：系统会自动识别一些设备，如U盘，光驱等，识别后挂在到这个目录下
  - **/mnt**：系统提供该目录为了让用户临时挂在别的文件系统的，可以将外部的存储挂在到/mnt上，进入该目录查看内容
  - **/opt**：给主机额外安装软件所存放的目录，如安装一个MySQL就是在该目录下
  - **/var**：目录中存放扩充的文件，习惯将经常修改的文件放在该文件夹下，包括日志文件
  - /selinx：一种安全子系统，可以控制程序只能访问特定的文件




## VI/VIM编辑器

### 是什么

VI是Unix系统和类Unix系统最常用的文本编辑器

VIM是从VI发展而来的文本编辑器，可以给字体颜色，来显示语法是否正确

VI和VM在linux系统下是完全兼容的

### 如何使用

拷贝文件数据作为练习

```shell
[root@stt01 home]# cp /etc/smartd.conf /root
[root@stt01 home]# cd /root
[root@stt01 ~]# vi smartd.conf 
```



#### 一般模式

以vi打开文档直接进入了一般模式（默认），在一般模式下，不要输入:

- 使用 `上下左右` 移动光标

常用语法

| 语法    | 功能                                                         |
| ------- | ------------------------------------------------------------ |
| yy      | **复制**光标当前行，复制之后要粘贴的话再按p                  |
| y4y     | 复制光标当前行往下4行，通用写法--y数字y                      |
| p       | 在当前光标处**粘贴**                                         |
| u       | **撤销**上一步                                               |
| dd      | **删除**光标当前**行**                                       |
| d4d     | 删除含关光标后4行，通用写法--d数字d                          |
| x       | **向后删除**一个字符，相当于del                              |
| X       | **向前删除**一个字符，相当于backspace                        |
| yw      | 复制一个词，光标在单词首字母处复制，规律是光标处字母到下一个空格之间的字符 |
| dw      | 删除光标后的一个词                                           |
| shift+^ | **移动到行头**                                               |
| shift+$ | **移动到行尾**                                               |
| gg      | **移动到页头**                                               |
| G       | **移动到页尾**                                               |
| 4G      | **移动到第四行**，通用写法：数字+G                           |

![1.vi.vim.keyword](img\linux\1.vi.vim.keyword.png)



#### 编辑模式

在一般模式可以进行删除，复制，粘贴动作，如果要编辑文本，需要进入编辑模式

- 按下 i ，I，o，O，a，A，r，R 进入编辑模式
- 进入编辑模式后，左下方会显示INSERT 或者 REPLACE 
- 按下 Esc 回到一般模式

| 按键 | 功能                       |
| ---- | -------------------------- |
| i    | 当前光标前，进入编辑模式   |
| I    | 光标所在的行最前           |
| o    | 当前光标的下一行           |
| O    | 当前光标的上一行           |
| a    | 当前光标后                 |
| A    | 光标所在的行最后           |
| s    | 删除当前字符并进入编辑模式 |
| S    | 删除整行并进入编辑模式     |


#### 命令模式

在一般模式下，输入【:/?】三个字符中的一个，就可以在最下面输入命令

| 命令        | 功能                                                         |
| ----------- | ------------------------------------------------------------ |
| :w          | 保存，:wq! 强制保存退出，:x等同于:wq!                        |
| :q          | 退出，:q! 强制退出                                           |
| :!          | 强制执行                                                     |
| /abc        | **查找**abc，按n查找下一个，N查找上一个，通用写法：/要查找的字符 |
| ?abc        | 同上                                                         |
| :set nu     | 显示标号                                                     |
| :set nonu   | 关闭标号                                                     |
| ZZ          | 没有修改文件之间退出，如果修改了，则保存后退出               |
| :%s/abc/def | 将abc批量替换为def，通用写法：%s/old字符/new字符             |

#### 模式间转换

![1551588870080](img\linux\1.vi.vim3.png)



## 网络配置

安装完虚拟机之后会有2个网卡

### 查看虚拟机IP和网关

点击编辑->虚拟网络编辑器

![1551589472025](img\linux\4.network.png)

查看网关：点击上图的【NAT设置(s)...】，记录当前网关地址

![1551589716888](img\linux\4.network2.png)

查看windows环境中的VMnet8的网络配置，点击VMnet8属性->TCP/IPV4->配置固定IP和DNS

![1551589872687](img\linux\4.network3.png)



### 配置网络IP地址

#### 查看网络配置

命令：ifconfig

```shell
ifconfig

eth0      Link encap:Ethernet  HWaddr 00:0C:29:D1:82:07  
          inet addr:192.168.1.128  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:29ff:fed1:8207/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:31630 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11163 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:26171770 (24.9 MiB)  TX bytes:795294 (776.6 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:334 errors:0 dropped:0 overruns:0 frame:0
          TX packets:334 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:24942 (24.3 KiB)  TX bytes:24942 (24.3 KiB)
```

此时的ip是使用DHCP动态获取的，需要改成静态ip

#### 修改IP地址

```shell
vim /etc/sysconfig/network-scripts/ifcfg-eth0

EVICE=eth0 					#接口名称，设备，网卡
HWADDR=00:0C:29:D1:82:07 	#MAC地址
TYPE=Ethernet  				#网络类型
UUID=fa28742b-9453-4009-8074-1f2c21a83305 #随机ID
NM_CONTROLLED=yes
# --------------需要修改项目---------------
ONBOOT=yes					#系统启动时网络接口是否有效（默认no）
BOOTPROTO=static			#IP的配置方式：none引导时不使用协议|static 静态配置|bootp协议|dhcp协议(默认)
IPADDR=192.168.1.100		#IP地址配置
GATEWAY=192.168.1.2			#网关配置
DNS1=114.114.114.114		#DNS 域名解析服务器配置
DNS2=8.8.8.8				#DNS 域名解析服务器配置
```

修改完成后，要重启网络服务

```shell
service network restart
```

如果有报错，则重启系统

```shell
reboot
```

测试，ping一下百度，看网络是否可以连接

```shell
ping www.baidu.com
```

此时再打开ifconfig，可以看到现有配置

#### 配置主机名

查看当前主机名

```shell
hostname
```

如果要修改主机名，那么在network文件中进行修改，并保存退出

```shell
vim /etc/sysconfig/network

NETWORKING=yes
HOSTNAME=stt01.demo # 此处可以进行修改，如修改为hadoop100（由于当前ip配置的是192.168.1.100，故便于记忆，加上100表示ip），注意主机名称不要有下划线
```

打开/etc/hosts 配置hadoop的其他机器的ip对应的名称

```shell
vim /etc/hosts

192.168.1.100 hadoop100
192.168.1.101 hadoop101
192.168.1.102 hadoop102
192.168.1.103 hadoop103
192.168.1.104 hadoop104
192.168.1.105 hadoop105
192.168.1.106 hadoop106
192.168.1.107 hadoop107
192.168.1.108 hadoop108
```

重启设备，重启完成后，查看主机名

配置windows下的hosts

```shell
进入C:\Windows\System32\drivers\etc
添加如下内容
192.168.1.100 hadoop100
192.168.1.101 hadoop101
192.168.1.102 hadoop102
192.168.1.103 hadoop103
192.168.1.104 hadoop104
192.168.1.105 hadoop105
192.168.1.106 hadoop106
192.168.1.107 hadoop107
192.168.1.108 hadoop108
```

## 系统操作

### 关闭防火墙

#### 后台服务状态管理

| 命令            | 功能                                                         |
| --------------- | ------------------------------------------------------------ |
| service start   | 开启服务：<br />service network start 启动网络服务，临时开启，关机之后失效 |
| service stop    | 关闭服务：<br />service network stop 关闭网络服务            |
| service restart | 重启服务：<br />service network restart 重启网络服务         |
| service status  | 查看服务状态：<br />service network status 查看网络服务的状态 <br />service --status-all 查看所有服务的状态 |

查看服务的方法

```shell
cd /etc/init.d
ll
```

#### 设置后台服务的自启配置

> 在服务启动时就生效，不需要每次手动启动，一次配置永久生效

| 命令                    | 功能                                                         |
| ----------------------- | ------------------------------------------------------------ |
| chkconfig               | 查看服务器所有的自启服务配置                                 |
| chkconfig 服务名 off    | 关闭指定服务的自启功能                                       |
| chkconfig 服务名 on     | 开启指定服务的自启功能                                       |
| chkconfig 服务名 --list | 查看服务开机启动的状态<br />示例：chkconfig network --list 查看网络状态 |

#### 防火墙操作

永久操作

```shell
# 查看防火墙状态
chkconfig iptables --list
iptables  0:关闭	1:关闭	2:启用	3:启用	4:启用	5:启用	6:关闭
# 关闭防火墙
chkconfig iptables off
# 再查看防火墙状态
chkconfig iptables --list
iptables  0:关闭	1:关闭	2:关闭	3:关闭	4:关闭	5:关闭	6:关闭
```

临时操作

```shell
# 查看防火墙状态
service iptables status
# 临时关闭防火墙
service iptables stop
```



#### 进程运行级别

从chkconfig查看状态的 0:关闭	1:关闭	2:启用	3:启用	4:启用	5:启用	6:关闭 分别表示Linux的进程的运行级别

开机->bios->/boot->init进程->运行级别->运行级别对应的服务

查看默认级别

```shell
vim /etc/inittab
```

Linux有7中运行级别：常用的级别是3和5

- 级别0：系统停机状态，系统默认运行状态不能设置为0，否则不能正常启动
- 级别1：单用户工作状态，root权限，用于系统维护，禁止远程登录
- 级别2：多用户状态，没有NFS，不支持网络
- 级别3：完全的多用户状态，有NFS，登录后进入控制台命令行模式
- 级别4：系统未使用，保留
- 级别5：X11控制台，登录后进入图形GUI模式
- 级别6：系统正常关闭并重启，默认运行级别不能设置为6，否则不能正常启动



### 关机重启

在Linux系统的大多数服务器上，很少有关机操作

正确的关机操作流程：sync-> shutdown -> reboot -> halt

| 命令                     | 功能                                                         |
| ------------------------ | ------------------------------------------------------------ |
| sync                     | 将数据从内存中同步到硬盘中                                   |
| halt                     | 关闭系统，等同于shutdown -h now 和 poweroff                  |
| reboot                   | 重启，等同于shutdown -r now                                  |
| shutdown [选项] 时间参数 | 选项：<br /> -h = halt 关机<br />-r = reboot 重启<br />参数：<br />now，立刻关机<br />数字，等待多久后关机，单位是分钟 |

Linux为了提高磁盘的读写效率，对磁盘采用了**预读迟写**的操作方式，当保存文件时，Linux核心不是立刻将数据保存到磁盘中，而是先保存到缓冲区，等缓冲区满了再一次性写入磁盘中，这种方式减少IO的开启和关闭，提高了磁盘写入数据的效率，但是如果数据还未写入到磁盘时，系统掉电或者其他宕机，将导致数据的丢失。**sync**命令是指将数据**立刻同步**到磁盘

```shell
# 同步数据
sync
# 重启
reboot
# 关机
halt
# 在2分钟后关机，显示登陆用户在当前屏幕中
shutdown -h 2 'this server will shutdown after 2 mins'
# 立刻关机 等同于halt
shutdown -h now
# 立刻重启 等同于reboot
shutdown -r now
```

### 找回root密码 

见资料中的pdf

### 克隆虚拟机

先关闭要克隆的虚拟机，在VM左操作栏目里的我的计算机->选中要克隆的虚拟机->右键->管理->克隆->下一步->克隆自 虚拟机的当前状态->下一步->创建完整克隆

设置克隆的虚拟机名称和存储位置，然后点击完成

修改克隆后的虚拟机的ip

```shell
vim /etc/udev/rules.d/70-persistent-net.rules
```

![1551599058903](img\linux\5.clone1.png)

将mac地址拷贝，将第一行eth0删除，将第二行的eth1改为eth0。

```shell
vim /etc/sysconfig/network-scripts/ifcfg-eth0
# 修改MAC地址，将刚复制的地址粘贴在HWADDR=字段上
# 修改IP，将IPADDR进行修改，这里修改为 192.168.1.101
```

修改主机名

```shell
vim /etc/sysconfig/network
# 将HOSTNAME该为hadoop101
```

重启服务器reboot

### 使用xshell进行连接登陆操作

打开文件，新建，添加名称和端口号，点击确定，选择刚添加的连接，点击连接，输入用户名root，输入密码，连接虚拟机。



## 软件包管理



### RPM 

> RedHat Package Manager 红帽软件管理工具，类似于windows中的setup.exe，是Linux系统的打包安装工具

RPM 的名称格式

Apache-1.3.23-11.i386.rpm

- Apache		软件名称
- -1.3.23-11	   软件的版本号，主版本和此版本
- -i386		    是软件的硬件平台
- rpm		     文件扩展名，代表RPM包



#### RPM 查询命令

```shell
rpm -qa
	查询所安装的rpm软件包，由于安装的比较多，一般使用rpm -a | grep xxx 进行过滤
```



#### RPM 卸载命令

```shell
rpm [选项] xxx
	
选项：
-e 			卸载软件包
--nodeps	卸载软件时不检查依赖，会导致有些软件依赖该卸载软件而不能使用
```



#### RPM 安装命令

```shell
rpm 选项 xxx
选项：
-i 		install 安装
-v 		verbose 显示详细信息
-h		hash 进度条
--nodeps	不检测依赖进度
示例：
rpm -ivh firefox-45.0.1-1.el6.centos.x86_64.rpm
```



### YUM 

> Yellow dog updater Modified，基于RPM包管理，可以从指定的服务器自动下载RPM包并安装，**自动处理依赖性关系**，一次安装所有依赖的包，类似于java的maven工具



#### 常用命令

```shell
yum [选项][参数]
选项：
-y 			对所有的提问都是yes
参数：
install 	安装rpm软件包
update		更新rpm软件包
check-update	检查是否有可更新的rpm软件包
remove		删除指定的rpm软件包
list		显示软件包信息
clean		清理yum过期的缓存
deplist		显示yum软件包的所有依赖关系
```



#### 修改YUM源

设置国内镜像

```shell
1.备份系统自带yum源配置文件
[root@hadoop100 home]# mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOs-Base.repo.backup
2.进入yum源配置文件所在文件夹
[root@hadoop100 home]# cd /etc/yum.repos.d/
3.下载163的yum源配置文件到该文件夹下
[root@hadoop100 yum.repos.d]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
4.更新缓存 可以先yum clean all
[root@hadoop100 yum.repos.d]# yum makecache
#5.更新软件包 如果没有需要可以不升级 升级所有软件
#yum -y update
```



#### 安装软件

- 安装rz sz命令，用于上传下载使用

```shell
yum -y install lrzsz 
```



## 面试问题

Linux查看内存、磁盘存储、io 读写、端口占用、进程等命令
1、查看内存：top
2、查看磁盘存储情况：df -h
3、查看磁盘IO读写情况：iotop（需要安装一下：yum install iotop）、iotop -o（直接查看输出比较高的磁盘读写程序）
4、查看端口占用情况：netstat -tunlp | grep 端口号
5、查看进程：ps aux

